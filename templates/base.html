<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title or 'Aditi Construction — Building the Future' }}</title>

  <!-- Core CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <link rel="icon" href="{{ url_for('static', filename='logo.png') }}" >

  <style>
  :root{
    --primary: #071a3a;
    --accent: #ffb400;
    --muted: #f3f6fb;
    --surface: #ffffff;
    --glass: rgba(255,255,255,0.06);
    --max-width:1200px;
  }

  /* ===== BASE ===== */
  html,body{
    height:100%;
    font-family:'Montserrat',sans-serif;
    background:var(--muted);
    color:#0b1320;
  }

  a{ color:inherit; text-decoration:none; }
  .container{ max-width:var(--max-width); }

  /* ===== NAVBAR ===== */
  .navbar-custom{
    background: linear-gradient(180deg, rgba(7,26,58,0.98), rgba(7,26,58,0.95));
    padding:.55rem 1rem;
    box-shadow:0 8px 30px rgba(7,26,58,0.12);
    position:sticky;
    top:0;
    z-index:1040;
  }
  .navbar-brand{
    color:var(--accent);
    font-weight:800;
    font-size:1.05rem;
  }
  .nav-link{
    color:#fff!important;
    font-weight:600;
    padding:.6rem .8rem;
  }
  .nav-link:hover{ color:var(--accent)!important; }
  .navbar-toggler{ border:0; }
  .navbar-toggler:focus{ outline:3px solid rgba(255,180,0,0.18); }

  /* ===== HERO ===== */
  .hero{
    min-height: calc(75vh - 72px);
    display:flex;
    align-items:center;
    position:relative;
    overflow:hidden;
    padding:2.5rem 0;
  }
  .hero::before{
    content:'';
    position:absolute;
    inset:0;
    z-index:-2;
    background-image:url('{{ hero_image if hero_image is defined else "https://images.unsplash.com/photo-1526406915891-95a9a0b0d1f0?auto=format&fit=crop&w=1600&q=60" }}');
    background-size:cover;
    background-position:center;
    filter: brightness(.45) saturate(.95);
  }
  .hero::after{
    content:'';
    position:absolute;
    inset:0;
    z-index:-1;
    background: linear-gradient(180deg, rgba(7,26,58,0.25), rgba(0,0,0,0.45));
  }

  .hero-inner{ position:relative; z-index:2; }
  .headline{
    font-size:1.75rem;
    font-weight:800;
    letter-spacing:.2px;
    margin-bottom:.6rem;
  }
  .subhead{
    font-size:1rem;
    color:rgba(255,255,255,.92);
    margin-bottom:1rem;
  }

  .btn-hero{
    background:var(--accent);
    color:var(--primary);
    font-weight:800;
    border-radius:999px;
    padding:.72rem 1.25rem;
    box-shadow:0 8px 30px rgba(11,19,32,0.12);
  }
  .btn-outline-hero{
    border:2px solid rgba(255,255,255,.16);
    color:#fff;
    padding:.58rem 1rem;
    font-weight:700;
  }

  @media(min-width:768px){
    .hero{ min-height: calc(85vh - 72px); padding:4rem 0; }
    .headline{ font-size:2.8rem; }
    .subhead{ font-size:1.15rem; }
  }
  @media(max-width:575px){
    .headline{ font-size:1.45rem; }
    .btn-hero, .btn-outline-hero{ width:100%; margin-bottom:.6rem; }
    .container{ padding:0 1rem; }
  }

  /* ===== PROJECT CARDS (FIXED OVERLAP ISSUE) ===== */
  .project-item{
    position:relative;
    border-radius:12px;
    overflow:hidden;
    background:#fff;
    height:300px;
    box-shadow:0 10px 30px rgba(11,19,32,0.06);
    display:flex;
    flex-direction:column;
  }

  .project-item img{
    width:100%;
    height:180px;
    object-fit:cover;
    border-bottom:1px solid #eee;
    transition: transform .5s ease;
  }
  .project-item:hover img{
    transform: scale(1.06);
  }

  .project-overlay{
    padding:16px;
    flex-grow:1;
  }

  .project-overlay h5{
    margin-bottom:4px;
    font-weight:700;
    color:#071a3a;
    font-size:1.05rem;
  }

  /* clean multiline truncation */
  .project-overlay p{
    font-size:.85rem;
    color:#444;
    overflow:hidden;
    display:-webkit-box;
    -webkit-line-clamp:3;
    -webkit-box-orient:vertical;
  }

  /* ===== SERVICE CARDS ===== */
  .service-card{
    background:#fff;
    border-radius:12px;
    padding:1.25rem;
    transition: transform .22s, box-shadow .22s;
    box-shadow:0 8px 26px rgba(11,19,32,0.06);
  }
  .service-card:hover{
    transform:translateY(-8px);
    box-shadow:0 18px 50px rgba(11,19,32,0.12);
  }

  /* ===== TESTIMONIALS ===== */
  .testimonials{
    padding:2.5rem 0;
    background: linear-gradient(180deg, rgba(7,26,58,0.04), rgba(7,26,58,0.02));
  }
  .testi-card{
    background:var(--primary);
    color:#fff;
    border-radius:10px;
    padding:1.3rem;
    box-shadow:0 14px 40px rgba(7,26,58,0.12);
  }

  /* ===== MAP ===== */
  .map-wrap iframe{
    width:100%;
    height:330px;
    border:0;
    border-radius:10px;
  }

  /* ===== FOOTER ===== */
  footer{
    background:#071a3a;
    color:#cfe6ff;
    padding:26px 0;
    font-size:.95rem;
  }
  footer a{ color:#fff; opacity:.92; }

  /* ===== Utilities ===== */
  .muted-sm{ color:rgba(11,19,32,0.6); }
  .small-muted{ color:rgba(11,19,32,0.55); }
  :focus{ outline:3px solid rgba(255,180,0,0.16); outline-offset:3px; }
</style>


  {% block extra_head %}{% endblock %}
</head>
<body>

  <!-- NAVIGATION -->
  <nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="logo" width="50" height="50" class="me-2 d-none d-md-inline">
        <span>Aditi Constructions</span>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav ms-auto align-items-lg-center">
          <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}">About</a></li>
          <li class="nav-item"><a class="nav-link" href="#services">Services</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('projects_page') }}">Projects</a></li>
          <li class="nav-item"><a class="nav-link" href="#testimonials">Testimonials</a></li>
          <li class="nav-item"><a class="nav-link" href="#contact">Contact</a></li>
          <li class="nav-item ms-2 d-none d-lg-block"><a class="btn btn-hero" href="#contact">Request Consultation</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- MAIN -->
  <main>

    <!-- FLASHES -->
    {% set flashed = get_flashed_messages(with_categories=true) %}
    {% if flashed %}
      <div class="container mt-4">
        {% for category, message in flashed %}
          {% set alert_class = 'info' %}
          {% if category %}
            {% if category in ['error','danger'] %}{% set alert_class = 'danger' %}
            {% elif category in ['success','ok'] %}{% set alert_class = 'success' %}
            {% elif category in ['warning','warn'] %}{% set alert_class = 'warning' %}
            {% elif category in ['info','message'] %}{% set alert_class = 'info' %}
            {% else %}{% set alert_class = category %}
            {% endif %}
          {% endif %}
          <div class="alert alert-{{ alert_class }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
<br>
    {% block content %}
    <!-- SAMPLE HERO (child templates may override) -->
    <header class="hero">
      <div class="container hero-inner">
        <div class="row">
          <div class="col-12 col-md-7">
            <div data-aos="fade-up">
              <h1 class="headline">Building the future with strength & precision.</h1>
              <p class="subhead">Reliable construction services — residential, commercial and renovation projects delivered on time and with care.</p>
              <div class="d-flex gap-2 flex-column flex-sm-row">
                <a href="#contact" class="btn btn-hero">Request a Quote</a>
                <a href="#projects" class="btn btn-outline-hero">View Projects</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    {% endblock %}

  </main>

  <!-- OFFERS MODAL -->
  <div class="modal fade" id="offersModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title text-primary">Current Offers</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="offersBody"></div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="mt-5">
    <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center gap-3">
      <div>
        <strong>Aditi Constructions</strong> · Building the future with strength and precision.
        <div class="small text-muted mt-1">45 Skyline Ave, City · +1 (555) 123-4567 · contact@skylinebuilders.com</div>
      </div>
      <div class="d-flex gap-3 align-items-center">
        <div class="small text-muted">&copy; {{ now().year if now is defined else 2025 }}</div>
        <a href="#" aria-label="Facebook" class="text-reset"><i class="fa-brands fa-facebook fa-lg"></i></a>
        <a href="#" aria-label="Instagram" class="text-reset"><i class="fa-brands fa-instagram fa-lg"></i></a>
        <a href="#" aria-label="LinkedIn" class="text-reset"><i class="fa-brands fa-linkedin fa-lg"></i></a>
      </div>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script>
    AOS.init({ duration: 700, once: true });

    // Navbar remains prominent on scroll
    const navbar = document.querySelector('.navbar-custom');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 40) navbar.classList.add('scrolled'); else navbar.classList.remove('scrolled');
    }, { passive: true });

    // Offers modal - show once per visitor
    (function(){
      try {
        if (localStorage.getItem('seen_offers')) return;
        fetch('{{ url_for("active_offers_api") }}').then(r=>r.json()).then(data=>{
          if (!data || !data.length) return;
          const body = document.getElementById('offersBody'); body.innerHTML = '';
          data.forEach(o=>{
            const el = document.createElement('div'); el.className='mb-3';
            el.innerHTML = `<h5 class="mb-1">${o.title}</h5><p class="mb-1">${o.details}</p><hr/>`;
            body.appendChild(el);
          });
          const modal = new bootstrap.Modal(document.getElementById('offersModal'));
          modal.show();
          localStorage.setItem('seen_offers','1');
        });
      } catch(e){}
    })();

    // Smooth internal links
    document.querySelectorAll('a[href^="#"]').forEach(a=>{
      a.addEventListener('click', function(e){
        const target = document.querySelector(this.getAttribute('href'));
        if (target){ e.preventDefault();
          const offset = target.getBoundingClientRect().top + window.pageYOffset - 72;
          window.scrollTo({ top: offset, behavior: 'smooth' });
        }
      });
    });
  </script>
  <script>
(async function showOffersEveryNthLoad(){
  const STORAGE_KEY = 'offers_reload_count_v1'; // counter key in localStorage
  const THRESHOLD = 6;                           // show on every THRESHOLD-th load (6th, 12th, ... )
  const FORCE_PARAM = 'force_offers';           // use ?force_offers=1 to show immediately (testing)

  try {
    const force = new URLSearchParams(window.location.search).get(FORCE_PARAM) === '1';

    // Fetch offers first — if no offers, don't increment counter or show anything
    const resp = await fetch('/api/active-offers', { cache: 'no-store' });
    if (!resp.ok) {
      console.warn('offers: failed to fetch offers', resp.status);
      return;
    }
    const offers = await resp.json();
    if (!Array.isArray(offers) || offers.length === 0) {
      console.debug('offers: no active offers -> skipping counter and modal');
      return;
    }

    // Get current counter, increment and persist
    let count = 0;
    try { count = parseInt(localStorage.getItem(STORAGE_KEY) || '0', 10); } catch(e){ count = 0; }
    count = (isNaN(count) ? 0 : count) + 1;

    console.debug(`offers: reload count = ${count} (threshold ${THRESHOLD})`);

    // If force param set, show immediately (but still reset counter afterwards)
    const shouldShow = force || (count % THRESHOLD === 0);

    if (shouldShow) {
      const body = document.getElementById('offersBody');
      const modalEl = document.getElementById('offersModal');
      if (!body || !modalEl) {
        console.warn('offers: modal DOM missing (#offersBody or #offersModal)');
      } else {
        body.innerHTML = '';
        offers.forEach(o => {
          const wrapper = document.createElement('div');
          wrapper.className = 'mb-3';

          const title = document.createElement('h5');
          title.className = 'mb-1';
          title.textContent = o.title || 'Offer';

          const desc = document.createElement('p');
          desc.className = 'mb-1';
          desc.textContent = o.details || '';

          wrapper.appendChild(title);
          wrapper.appendChild(desc);

          if (o.starts_at || o.ends_at) {
            const small = document.createElement('small');
            small.className = 'text-muted d-block mb-2';
            const parts = [];
            if (o.starts_at) parts.push('Starts: ' + new Date(o.starts_at).toLocaleString());
            if (o.ends_at) parts.push('Ends: ' + new Date(o.ends_at).toLocaleString());
            small.textContent = parts.join(' • ');
            wrapper.appendChild(small);
          }

          wrapper.appendChild(document.createElement('hr'));
          body.appendChild(wrapper);
        });

        const modal = new bootstrap.Modal(modalEl, { keyboard: true, backdrop: true });
        modal.show();
      }

      // Reset counter after showing
      try { localStorage.setItem(STORAGE_KEY, '0'); } catch(e){ /* ignore */ }
      console.debug('offers: modal shown -> counter reset to 0');
    } else {
      // Save incremented count and do not show
      try { localStorage.setItem(STORAGE_KEY, String(count)); } catch(e){ /* ignore */ }
    }

  } catch (err) {
    console.error('offers: unexpected error', err);
  }
})();
</script>

  {% block scripts %}{% endblock %}
</body>
</html>
